%%
%% This is file `modernrules.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% modernrules.dtx  (with options: `package')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from modernrules.sty.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file modernrules.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{modernrules}[2024/10/31 Modern Style for RPG Rulebooks]




\RequirePackage{etoolbox}
\RequirePackage{truncate}
\RequirePackage{titlesec}
\RequirePackage{geometry}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
\RequirePackage{fontspec}
\RequirePackage{tcolorbox}
\RequirePackage{hyperref}
\RequirePackage{fancyhdr}
\RequirePackage{parskip}
\RequirePackage{xparse}
\RequirePackage{expl3}
\RequirePackage{indentfirst}



\geometry{a4paper, margin=1in}
\setlength{\parindent}{1cm} % Parágrafos com indentação
\setlength{\parskip}{0.5em} % Espaço entre parágrafos


\setmainfont{Montserrat} % Fontes modernas e legíveis
\setsansfont{Montserrat}
\newfontfamily\headingfont{Montserrat Bold}

\definecolor{primarycolor}{HTML}{1A237E} % Azul escuro moderno
\definecolor{secondarycolor}{HTML}{546E7A} % Cinza moderno para subtítulos


\titleformat{\part}[display]
  {\centering\headingfont\Huge\bfseries\color{primarycolor}}
  {Parte \thepart}{1em}{}
\titlespacing*{\part}{0pt}{2em}{1em}

\titleformat{\chapter}[hang]
  {\headingfont\LARGE\bfseries\color{primarycolor}}
  {Capítulo \thechapter.}{1em}{}
  [\vspace{0.5em}]
\titlespacing*{\chapter}{0pt}{0pt}{1em}

\titleformat{\section}[block]
  {\headingfont\Large\bfseries\color{secondarycolor}}
  {\thesection}{1em}{\raggedright}
\titlespacing*{\section}{0pt}{1em plus 0.5em minus 0.5em}{0.5em}

\titleformat{\subsection}[block]
  {\headingfont\large\bfseries\color{secondarycolor}}
  {\thesubsection}{1em}{\raggedright}
\titlespacing*{\subsection}{0pt}{1em plus 0.5em minus 0.5em}{0.5em}

\titleformat{\subsubsection}[runin]
  {\bfseries\color{secondarycolor}}
  {\thesubsubsection}{1em}{\raggedright}
\titlespacing*{\subsubsection}{0pt}{1em plus 0.5em minus 0.5em}{0pt}


\pagestyle{fancy}
\setlength{\headheight}{15.23404pt}
\fancyhf{}
\fancyhead[L]{\headingfont\color{primarycolor} \truncate{0.4\textwidth}{\leftmark}}
\fancyhead[R]{\headingfont\color{primarycolor} ANVESN RPG}
\fancyfoot[C]{\thepage}


\newtcolorbox{rulesection}{
  colback=primarycolor!5!white, colframe=primarycolor,
  fonttitle=\bfseries, coltitle=black, colbacktitle=primarycolor!20!white,
  title=Destaque, top=4pt, bottom=4pt, left=4pt, right=4pt,
  boxrule=0.4pt, width=\textwidth
}


\hypersetup{
  colorlinks=true,
  linkcolor=primarycolor,
  urlcolor=primarycolor,
  citecolor=primarycolor
}


\newcommand{\rulesbox}[2]{
  \begin{rulesection}[title=#1]
    #2
  \end{rulesection}
}


\newcommand{\dice}[1]{
  \textbf{\textcolor{primarycolor}{#1}}
}

\newcommand{\note}[1]{
  \textit{\textcolor{secondarycolor}{\faInfoCircle\ #1}}
}


\renewcommand{\maketitle}{
  \begin{titlepage}
    \centering
    \ifdefined\@titleimagebefore
      \includegraphics[width=0.6\textwidth]{\@titleimagebefore}
      \vspace{1em}
    \fi
    {\headingfont\Huge\color{primarycolor}\textbf{\@title}}\\[1em]
    {\Large\color{secondarycolor}\@author}\\[2em]
    {\large\@date}
    \ifdefined\@titleimageafter
      \vspace{2em}
      \includegraphics[width=0.6\textwidth]{\@titleimageafter}
    \fi
  \end{titlepage}
}


\NewTColorBox{personagem}{ O{Personagem} }{
  colback=blue!5!white, colframe=primarycolor,
  fonttitle=\bfseries, coltitle=black, colbacktitle=primarycolor!20!white,
  title={#1},
  top=4pt, bottom=4pt, left=4pt, right=4pt,
  boxrule=0.4pt, width=\textwidth
}


\ExplSyntaxOn
\cs_new_protected:Npn \index_first_part:nn #1 #2 {
  \str_if_in:nnTF {#1} {#2}
    {
      \seq_set_split:Nnn \l_tmpa_seq {#2} {#1}
      \index{\seq_item:Nn \l_tmpa_seq {1}}
    }
    {
      \index{#1}
    }
}

\NewDocumentCommand{\dperson}{m m m}{
  \index_first_part:nn {#1} {,}
  \begin{personagem}[Personagem:\   #1]
    \if\relax\detokenize{#2}\relax
    \else
      \par\textbf{Descrição:} #2
    \fi
    \if\relax\detokenize{#3}\relax
    \else
      \par\textbf{Atributos:} #3
    \fi
  \end{personagem}
}
\ExplSyntaxOff

\endinput
%%
%% End of file `modernrules.sty'.
